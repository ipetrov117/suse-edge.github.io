<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><title>SUSE Edge Documentation | Remote host onboarding with Elemental</title><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/><link rel="stylesheet" type="text/css" href="static/css/style.css"/>
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/"/>
<meta name="title" content="Remote host onboarding with Elemental"/>
<meta name="description" content="This section documents the &quot;phone home network provisioning&quot; solution as part of SUSE Edge, where we use Elemental to assist with node onboarding. El…"/>
<meta name="book-title" content="SUSE Edge Documentation"/>
<meta name="chapter-title" content="Chapter 2. Remote host onboarding with Elemental"/>
<meta name="tracker-url" content="https://github.com/suse-edge/suse-edge.github.io/issues/new"/>
<meta name="tracker-type" content="gh"/>
<meta name="publisher" content="SUSE"/><meta property="og:title" content="Remote host onboarding with Elemental"/>
<meta property="og:description" content="This section documents the &quot;phone home network provisioning…"/>
<meta property="og:type" content="article"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Remote host onboarding with Elemental"/>
<meta name="twitter:description" content="This section documents the &quot;phone home network provisioning…"/>
<script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": ["TechArticle"],
    "image": "https://www.suse.com/assets/img/suse-white-logo-green.svg",
    
     "isPartOf": {
      "@type": "CreativeWorkSeries",
      "name": "Product &amp; Solutions"
    },
    
    "inLanguage": "en",
    

    "headline": "Remote host onboarding with Elemental",
  
    "description": "Remote host onboarding with Elemental",
      
    "author": [
      {
        "@type": "Corporation",
        "name": "SUSE Product &amp; Solution Documentation Team",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    ],
      

    "about": [
      
    ],
  
    "sameAs": [
          "https://www.facebook.com/SUSEWorldwide/about",
          "https://www.youtube.com/channel/UCHTfqIzPKz4f_dri36lAQGA",
          "https://twitter.com/SUSE",
          "https://www.linkedin.com/company/suse"
    ],
    "publisher": {
      "@type": "Corporation",
      "name": "SUSE",
      "url": "https://documentation.suse.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.suse.com/assets/img/suse-white-logo-green.svg"
      }
    }
  }</script>
<link rel="prev" href="quickstart-metal3.html" title="Chapter 1. BMC automated deployments with Metal3"/><link rel="next" href="quickstart-eib.html" title="Chapter 3. Standalone clusters with Edge Image Builder"/><script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"></link>');
};

</script><noscript><link rel="stylesheet" type="text/css" href="https://documentation.suse.com/docserv/res/fonts/poppins/poppins.css"/></noscript><script src="static/js/script-purejs.js" type="text/javascript"> </script><script src="static/js/highlight.min.js" type="text/javascript"> </script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="wide offline js-off"><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-pagination">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><header id="_mainnav"><div class="growth-inhibitor"><img src="static/images/logo.svg" alt="Logo" class="logo"/></div></header><div class="crumbs"><div class="growth-inhibitor"><a class="crumb" href="index.html">SUSE Edge Documentation</a><span> / </span><a class="crumb" href="id-quick-starts.html">Quick Starts</a><span> / </span><a class="crumb" href="quickstart-elemental.html">Remote host onboarding with Elemental</a></div></div><main id="_content"><nav id="_side-toc-overall" class="side-toc"><div class="side-title">SUSE Edge Documentation</div><ol><li><a href="id-suse-edge-documentation.html" class=" "><span class="title-number"> </span><span class="title-name">SUSE Edge Documentation</span></a></li><li class="active"><a href="id-quick-starts.html" class="has-children you-are-here"><span class="title-number">I </span><span class="title-name">Quick Starts</span></a><ol><li><a href="quickstart-metal3.html" class=" "><span class="title-number">1 </span><span class="title-name">BMC automated deployments with Metal<sup>3</sup></span></a></li><li><a href="quickstart-elemental.html" class=" you-are-here"><span class="title-number">2 </span><span class="title-name">Remote host onboarding with Elemental</span></a></li><li><a href="quickstart-eib.html" class=" "><span class="title-number">3 </span><span class="title-name">Standalone clusters with Edge Image Builder</span></a></li></ol></li><li><a href="id-components-used.html" class="has-children "><span class="title-number">II </span><span class="title-name">Components Used</span></a><ol><li><a href="components-rancher.html" class=" "><span class="title-number">4 </span><span class="title-name">Rancher</span></a></li><li><a href="components-rancher-dashboard-extensions.html" class=" "><span class="title-number">5 </span><span class="title-name">Rancher Dashboard Extensions</span></a></li><li><a href="components-fleet.html" class=" "><span class="title-number">6 </span><span class="title-name">Fleet</span></a></li><li><a href="components-slmicro.html" class=" "><span class="title-number">7 </span><span class="title-name">SLE Micro</span></a></li><li><a href="components-metal3.html" class=" "><span class="title-number">8 </span><span class="title-name">Metal<sup>3</sup></span></a></li><li><a href="components-eib.html" class=" "><span class="title-number">9 </span><span class="title-name">Edge Image Builder</span></a></li><li><a href="components-nmc.html" class=" "><span class="title-number">10 </span><span class="title-name">Edge Networking</span></a></li><li><a href="components-elemental.html" class=" "><span class="title-number">11 </span><span class="title-name">Elemental</span></a></li><li><a href="components-akri.html" class=" "><span class="title-number">12 </span><span class="title-name">Akri</span></a></li><li><a href="components-k3s.html" class=" "><span class="title-number">13 </span><span class="title-name">K3s</span></a></li><li><a href="components-rke2.html" class=" "><span class="title-number">14 </span><span class="title-name">RKE2</span></a></li><li><a href="components-longhorn.html" class=" "><span class="title-number">15 </span><span class="title-name">Longhorn</span></a></li><li><a href="components-neuvector.html" class=" "><span class="title-number">16 </span><span class="title-name">NeuVector</span></a></li><li><a href="components-metallb.html" class=" "><span class="title-number">17 </span><span class="title-name">MetalLB</span></a></li><li><a href="components-kubevirt.html" class=" "><span class="title-number">18 </span><span class="title-name">Edge Virtualization</span></a></li></ol></li><li><a href="id-how-to-guides.html" class="has-children "><span class="title-number">III </span><span class="title-name">How-To Guides</span></a><ol><li><a href="guides-metallb-k3s.html" class=" "><span class="title-number">19 </span><span class="title-name">MetalLB on K3s (using L2)</span></a></li><li><a href="guides-metallb-kubernetes.html" class=" "><span class="title-number">20 </span><span class="title-name">MetalLB in front of the Kubernetes API server</span></a></li><li><a href="id-air-gapped-deployments-with-edge-image-builder.html" class=" "><span class="title-number">21 </span><span class="title-name">Air-gapped deployments with Edge Image Builder</span></a></li></ol></li><li><a href="id-third-party-integration.html" class="has-children "><span class="title-number">IV </span><span class="title-name">Third-Party Integration</span></a><ol><li><a href="integrations-nats.html" class=" "><span class="title-number">22 </span><span class="title-name">NATS</span></a></li><li><a href="id-nvidia-gpus-on-sle-micro.html" class=" "><span class="title-number">23 </span><span class="title-name">NVIDIA GPUs on SLE Micro</span></a></li></ol></li><li><a href="id-day-2-operations.html" class="has-children "><span class="title-number">V </span><span class="title-name">Day 2 Operations</span></a><ol><li><a href="day2-mgmt-cluster.html" class=" "><span class="title-number">24 </span><span class="title-name">Management Cluster</span></a></li><li><a href="id-downstream-clusters.html" class=" "><span class="title-number">25 </span><span class="title-name">Downstream clusters</span></a></li></ol></li><li><a href="id-product-documentation.html" class="has-children "><span class="title-number">VI </span><span class="title-name">Product Documentation</span></a><ol><li><a href="atip.html" class=" "><span class="title-number">26 </span><span class="title-name">SUSE Adaptive Telco Infrastructure Platform (ATIP)</span></a></li><li><a href="atip-architecture.html" class=" "><span class="title-number">27 </span><span class="title-name">Concept &amp; Architecture</span></a></li><li><a href="atip-requirements.html" class=" "><span class="title-number">28 </span><span class="title-name">Requirements &amp; Assumptions</span></a></li><li><a href="atip-management-cluster.html" class=" "><span class="title-number">29 </span><span class="title-name">Setting up the management cluster</span></a></li><li><a href="atip-features.html" class=" "><span class="title-number">30 </span><span class="title-name">Telco features configuration</span></a></li><li><a href="atip-automated-provisioning.html" class=" "><span class="title-number">31 </span><span class="title-name">Fully automated directed network provisioning</span></a></li><li><a href="atip-lifecycle.html" class=" "><span class="title-number">32 </span><span class="title-name">Lifecycle actions</span></a></li></ol></li><li><a href="id-release-notes.html" class=" "><span class="title-number">A </span><span class="title-name">Release Notes</span></a></li> </ol> </nav><button id="_open-side-toc-overall" title="Contents"> </button><article class="documentation"><button id="_unfold-side-toc-page">On this page</button><section class="chapter" id="quickstart-elemental" data-id-title="Remote host onboarding with Elemental"><div class="titlepage"><div><div><div class="title-container"><h1 class="title"><span class="title-number-name"><span class="title-number">2 </span><span class="title-name">Remote host onboarding with Elemental</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#">#</a></h1><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>This section documents the "phone home network provisioning" solution as part of SUSE Edge, where we use Elemental to assist with node onboarding. Elemental is a software stack enabling remote host registration and centralized full cloud-native OS management with Kubernetes. In the SUSE Edge stack we use the registration feature of Elemental to enable remote host onboarding into Rancher so that hosts can be integrated into a centralized management platform and from there, deploy and manage Kubernetes clusters along with layered components, applications, and their lifecycle, all from a common place.</p><p>This approach can be useful in scenarios where the devices that you want to control are not on the same network as the upstream cluster or do not have a out-of-band management controller onboard to allow more direct control, and where you’re booting many different "unknown" systems at the edge, and need to securely onboard and manage them at scale. This is a common scenario for use cases in retail, industrial IoT, or other spaces where you have little control over the network your devices are being installed in.</p><section class="sect1" id="id-high-level-architecture-2" data-id-title="High-level architecture"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.1 </span><span class="title-name">High-level architecture</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-high-level-architecture-2">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="informalfigure"><div class="mediaobject"><a href="images/quickstart-elemental-architecture.png"><img src="images/quickstart-elemental-architecture.png" width="NaN" alt="quickstart elemental architecture" title="quickstart elemental architecture"/></a></div></div></section><section class="sect1" id="id-resources-needed" data-id-title="Resources needed"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.2 </span><span class="title-name">Resources needed</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-resources-needed">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The following describes the minimum system and environmental requirements to run through this quickstart:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A host for the centralized management cluster (the one hosting Rancher and Elemental):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Minimum 8 GB RAM and 20 GB disk space for development or testing (see <a class="link" href="https://ranchermanager.docs.rancher.com/pages-for-subheaders/installation-requirements#hardware-requirements" target="_blank">here</a> for production use)</p></li></ul></div></li><li class="listitem"><p>A target node to be provisioned, i.e. the edge device (a virtual machine can be used for demoing or testing purposes)</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Minimum 4GB RAM, 2 CPU cores, and 20 GB disk</p></li></ul></div></li><li class="listitem"><p>A resolvable host name for the management cluster or a static IP address to use with a service like sslip.io</p></li><li class="listitem"><p>A host to build the installation media via Edge Image Builder</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Running SLES 15 SP5, openSUSE Leap 15.5, or another compatible operating system that supports Podman.</p></li><li class="listitem"><p>With <a class="link" href="https://kubernetes.io/docs/reference/kubectl/kubectl/" target="_blank">Kubectl</a>, <a class="link" href="https://podman.io" target="_blank">Podman</a>, and <a class="link" href="https://helm.sh" target="_blank">Helm</a> installed</p></li></ul></div></li><li class="listitem"><p>A USB flash drive to boot from (if using physical hardware)</p></li></ul></div><div id="id-1.3.4.5.4" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>Existing data found on target machines will be overwritten as part of the process, please make sure you backup any data on any USB storage devices and disks attached to target deployment nodes.</p></div><p>This guide is created using a Digital Ocean droplet to host the upstream cluster and an Intel NUC as the downstream device. For building the installation media, SUSE Linux Enterprise Server is used.</p></section><section class="sect1" id="id-how-to-use-elemental" data-id-title="How to use Elemental"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.3 </span><span class="title-name">How to use Elemental</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-how-to-use-elemental">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>The basic steps to install and use Elemental are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="xref" href="quickstart-elemental.html#build-bootstrap-cluster" title="2.3.1. Build bootstrap cluster">Section 2.3.1, “Build bootstrap cluster”</a></p></li><li class="listitem"><p><a class="xref" href="quickstart-elemental.html#install-rancher" title="2.3.2. Install Rancher">Section 2.3.2, “Install Rancher”</a></p></li><li class="listitem"><p><a class="xref" href="quickstart-elemental.html#install-elemental" title="2.3.3. Install Elemental">Section 2.3.3, “Install Elemental”</a></p></li><li class="listitem"><p><a class="xref" href="quickstart-elemental.html#build-installation-media" title="2.3.4. Build the installation media">Section 2.3.4, “Build the installation media”</a></p></li><li class="listitem"><p><a class="xref" href="quickstart-elemental.html#boot-downstream-nodes" title="2.3.5. Boot the downstream nodes">Section 2.3.5, “Boot the downstream nodes”</a></p></li><li class="listitem"><p><a class="xref" href="quickstart-elemental.html#create-downstream-clusters" title="2.3.6. Create downstream clusters">Section 2.3.6, “Create downstream clusters”</a></p></li></ul></div><section class="sect2" id="build-bootstrap-cluster" data-id-title="Build bootstrap cluster"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.1 </span><span class="title-name">Build bootstrap cluster</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#build-bootstrap-cluster">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Start by creating a cluster capable of hosting Rancher and Elemental. This cluster needs to be routable from the network that the downstream nodes are connected to.</p><section class="sect3" id="id-create-kubernetes-cluster" data-id-title="Create Kubernetes cluster"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.3.1.1 </span><span class="title-name">Create Kubernetes cluster</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-create-kubernetes-cluster">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>If you are using a hyperscaler (such as Azure, AWS or Google Cloud), the easiest way to set up a cluster is using their built-in tools. For the sake of conciseness in this guide, we do not detail the process of each of these options.</p><p>If you are installing onto bare metal or another hosting service where you need to also provide the Kubernetes distribution itself, we recommend using <a class="link" href="https://docs.rke2.io/install/quickstart" target="_blank">RKE2</a>.</p></section><section class="sect3" id="id-set-up-dns" data-id-title="Set up DNS"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.3.1.2 </span><span class="title-name">Set up DNS</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-set-up-dns">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Before continuing, you need to set up access to your cluster. As with the setup of the cluster itself, how you configure DNS will be different depending on where it is being hosted.</p><div id="id-1.3.4.6.4.4.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>If you do not want to handle setting up DNS records (for example, this is just an ephemeral test server), you can use a service like <a class="link" href="https://sslip.io" target="_blank">sslip.io</a> instead. With this service, you can resolve any IP address with <code class="literal">&lt;address&gt;.sslip.io</code>.</p></div></section></section><section class="sect2" id="install-rancher" data-id-title="Install Rancher"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.2 </span><span class="title-name">Install Rancher</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#install-rancher">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>To install Rancher, you need to get access to the Kubernetes API of the cluster you just created. This looks differently depending on what distribution of Kubernetes is being used.</p><p>For RKE2, the kubeconfig file will have been written to <code class="literal">/etc/rancher/rke2/rke2.yaml</code>.
Save this file as <code class="literal">~/.kube/config</code> on your local system.
You may need to edit the file to include the correct externally routable IP address or host name.</p><p>Install Rancher easily with the commands from the <a class="link" href="https://ranchermanager.docs.rancher.com/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster" target="_blank">Rancher Documentation</a>:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Install <a class="link" href="https://cert-manager.io" target="_blank">cert-manager</a>:</p><div class="variablelist"><dl class="variablelist tabs"><dt id="id-1.3.4.6.5.5.1.2.1"><span class="term">Linux</span></dt><dd><div class="verbatim-wrap highlight bash"><pre class="screen">helm repo add rancher-prime https://charts.rancher.com/server-charts/prime

kubectl create namespace cattle-system

kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.3/cert-manager.crds.yaml
helm repo add jetstack https://charts.jetstack.io

helm repo update

helm install cert-manager jetstack/cert-manager \
 --namespace cert-manager \
 --create-namespace</pre></div></dd><dt id="id-1.3.4.6.5.5.1.2.2"><span class="term">Windows</span></dt><dd><div class="verbatim-wrap highlight bash"><pre class="screen">helm repo add rancher-prime https://charts.rancher.com/server-charts/prime

kubectl create namespace cattle-system

kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.3/cert-manager.crds.yaml

helm repo add jetstack https://charts.jetstack.io

helm repo update
helm install cert-manager jetstack/cert-manager `
  --namespace cert-manager `
  --create-namespace</pre></div></dd></dl></div></li><li class="listitem"><p>Then install Rancher itself:</p><div class="variablelist"><dl class="variablelist tabs"><dt id="id-1.3.4.6.5.5.2.2.1"><span class="term">Linux</span></dt><dd><div class="verbatim-wrap highlight bash"><pre class="screen">helm install rancher rancher-prime/rancher \
  --namespace cattle-system \
  --set hostname=&lt;DNS or sslip from above&gt; \
  --set replicas=1 \
  --set bootstrapPassword=&lt;PASSWORD_FOR_RANCHER_ADMIN&gt;</pre></div></dd><dt id="id-1.3.4.6.5.5.2.2.2"><span class="term">Windows</span></dt><dd><div class="verbatim-wrap highlight bash"><pre class="screen">helm install rancher rancher-prime/rancher `
  --namespace cattle-system `
  --set hostname=&lt;DNS or sslip from above&gt; `
  --set replicas=1 `
  --set bootstrapPassword=&lt;PASSWORD_FOR_RANCHER_ADMIN&gt;</pre></div></dd></dl></div></li></ol></div><div id="id-1.3.4.6.5.6" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>If this is intended to be a production system, please use cert-manager to configure a real certificate (such as one from Let’s Encrypt).</p></div><p>Browse to the host name you set up and log in to Rancher with the <code class="literal">bootstrapPassword</code> you used. You will be guided through a short setup process.</p></section><section class="sect2" id="install-elemental" data-id-title="Install Elemental"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.3 </span><span class="title-name">Install Elemental</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#install-elemental">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>With Rancher installed, you can now install the Elemental operator and required CRD’s. The Helm chart for Elemental is published as an OCI artifact so the installation is a little simpler than other charts.
It can be installed from either the same shell you used to install Rancher or in the browser from within Rancher’s shell.</p><div class="verbatim-wrap highlight bash"><pre class="screen">helm install --create-namespace -n cattle-elemental-system \
 elemental-operator-crds \
 oci://registry.suse.com/rancher/elemental-operator-crds-chart

helm install --create-namespace -n cattle-elemental-system \
 elemental-operator \
 oci://registry.suse.com/rancher/elemental-operator-chart</pre></div><section class="sect3" id="id-optionally-install-the-elemental-ui-extension" data-id-title="(Optionally) Install the Elemental UI extension"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.3.3.1 </span><span class="title-name">(Optionally) Install the Elemental UI extension</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-optionally-install-the-elemental-ui-extension">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>To use the Elemental UI, log in to your Rancher instance, click the three-dot menu in the upper left:</p><div class="informalfigure"><div class="mediaobject"><a href="images/installing-elemental-extension-1.png"><img src="images/installing-elemental-extension-1.png" width="NaN" alt="Installing Elemental extension1" title="Installing Elemental extension1"/></a></div></div></li><li class="listitem"><p>From the "Available" tab on this page, click "Install" on the Elemental card:</p><div class="informalfigure"><div class="mediaobject"><a href="images/installing-elemental-extension-2.png"><img src="images/installing-elemental-extension-2.png" width="NaN" alt="Installing Elemental extension 2" title="Installing Elemental extension 2"/></a></div></div></li><li class="listitem"><p>Confirm that you want to install the extension:</p><div class="informalfigure"><div class="mediaobject"><a href="images/installing-elemental-extension-3.png"><img src="images/installing-elemental-extension-3.png" width="NaN" alt="Installing Elemental extension 3" title="Installing Elemental extension 3"/></a></div></div></li><li class="listitem"><p>After it installs, you will be prompted to reload the page.</p><div class="informalfigure"><div class="mediaobject"><a href="images/installing-elemental-extension-4.png"><img src="images/installing-elemental-extension-4.png" width="NaN" alt="Installing Elemental extension 4" title="Installing Elemental extension 4"/></a></div></div></li><li class="listitem"><p>Once you reload, you can access the Elemental extension through the "OS Management" global app.</p><div class="informalfigure"><div class="mediaobject"><a href="images/accessing-elemental-extension.png"><img src="images/accessing-elemental-extension.png" width="NaN" alt="Accessing Elemental extension" title="Accessing Elemental extension"/></a></div></div></li></ol></div></section><section class="sect3" id="id-configure-elemental" data-id-title="Configure Elemental"><div class="titlepage"><div><div><div class="title-container"><h4 class="title"><span class="title-number-name"><span class="title-number">2.3.3.2 </span><span class="title-name">Configure Elemental</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-configure-elemental">#</a></h4><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>For simplicity, we recommend setting the variable <code class="literal">$ELEM</code> to the full path of where you want the configuration directory:</p><div class="verbatim-wrap"><pre class="screen">export ELEM=$HOME/elemental
mkdir -p $ELEM</pre></div><p>To allow machines to register to Elemental, we need to create a <code class="literal">MachineRegistration</code> object in the <code class="literal">fleet-default</code> namespace.</p><p>Let us create a basic version of this object:</p><div class="verbatim-wrap"><pre class="screen">cat &lt;&lt; EOF &gt; $ELEM/registration.yaml
apiVersion: elemental.cattle.io/v1beta1
kind: MachineRegistration
metadata:
  name: ele-quickstart-nodes
  namespace: fleet-default
spec:
  machineName: "\${System Information/Manufacturer}-\${System Information/UUID}"
  machineInventoryLabels:
    manufacturer: "\${System Information/Manufacturer}"
    productName: "\${System Information/Product Name}"
EOF

kubectl apply -f $ELEM/registration.yaml</pre></div><div id="id-1.3.4.6.6.5.7" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>The <code class="literal">cat</code> command escapes each <code class="literal">$</code> with a backslash (<code class="literal">\</code>) so that Bash does not template them. Remove the backslashes if copying manually.</p></div><p>Once the object is created, find and note the endpoint that gets assigned:</p><div class="verbatim-wrap highlight bash"><pre class="screen">REGISURL=$(kubectl get machineregistration ele-quickstart-nodes -n fleet-default -o jsonpath='{.status.registrationURL}')</pre></div><p>Alternatively, this can also be done from the UI.</p><div class="variablelist"><dl class="variablelist"><dt id="id-1.3.4.6.6.5.11.1"><span class="term">UI Extension</span></dt><dd><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>From the OS Management extension, click "Create Registration Endpoint":</p><div class="informalfigure"><div class="mediaobject"><a href="images/click-create-registration.png"><img src="images/click-create-registration.png" width="NaN" alt="Click Create Registration" title="Click Create Registration"/></a></div></div></li><li class="listitem"><p>Give this configuration a name.</p><div class="informalfigure"><div class="mediaobject"><a href="images/create-registration-name.png"><img src="images/create-registration-name.png" width="NaN" alt="Add Name" title="Add Name"/></a></div></div><div id="id-1.3.4.6.6.5.11.1.2.1.2.3" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>You can ignore the Cloud Configuration field as the data here is overridden by the following steps with Edge Image Builder.</p></div></li><li class="listitem"><p>Next, scroll down and click "Add Label" for each label you want to be on the resource that gets created when a machine registers. This is useful for distinguishing machines.</p><div class="informalfigure"><div class="mediaobject"><a href="images/create-registration-labels.png"><img src="images/create-registration-labels.png" width="NaN" alt="Add Labels" title="Add Labels"/></a></div></div></li><li class="listitem"><p>Lastly, click "Create" to save the configuration.</p><div class="informalfigure"><div class="mediaobject"><a href="images/create-registration-create.png"><img src="images/create-registration-create.png" width="NaN" alt="Click Create" title="Click Create"/></a></div></div></li></ol></div></dd><dt id="id-1.3.4.6.6.5.11.2"><span class="term">UI Extension</span></dt><dd><p>If you just created the configuration, you should see the Registration URL listed and can click "Copy" to copy the address:</p><div class="informalfigure"><div class="mediaobject"><a href="images/get-registration-url.png"><img src="images/get-registration-url.png" width="NaN" alt="Copy URL" title="Copy URL"/></a></div></div><div id="id-1.3.4.6.6.5.11.2.2.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>If you clicked away from that screen, you can click "Registration Endpoints" in the left menu, then click the name of the endpoint you just created.</p></div></dd></dl></div><p>This URL is used in the next step.</p></section></section><section class="sect2" id="build-installation-media" data-id-title="Build the installation media"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.4 </span><span class="title-name">Build the installation media</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#build-installation-media">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>While the current version of Elemental has a way to build its own installation media, in SUSE Edge 3.0 we do this with the Edge Image Builder instead, so the resulting system is built with <a class="link" href="https://www.suse.com/products/micro/" target="_blank">SLE Micro</a> as the base Operating System.</p><div id="id-1.3.4.6.7.3" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>For more details on the Edge Image Builder, check out the Getting Started Guide for it (<a class="xref" href="quickstart-eib.html" title="Chapter 3. Standalone clusters with Edge Image Builder">Chapter 3, <em>Standalone clusters with Edge Image Builder</em></a>) and also the Component Documentation (<a class="xref" href="components-eib.html" title="Chapter 9. Edge Image Builder">Chapter 9, <em>Edge Image Builder</em></a>).</p></div><p>From a Linux system with Podman installed, run:</p><div class="verbatim-wrap highlight bash"><pre class="screen">mkdir -p $ELEM/eib_quickstart/base-images
mkdir -p $ELEM/eib_quickstart/elemental</pre></div><div class="verbatim-wrap highlight bash"><pre class="screen">curl $REGISURL -o $ELEM/eib_quickstart/elemental/elemental_config.yaml</pre></div><div class="verbatim-wrap highlight bash"><pre class="screen">cat &lt;&lt; EOF &gt; $ELEM/eib_quickstart/eib-config.yaml
apiVersion: 1.0
image:
    imageType: iso
    arch: x86_64
    baseImage: SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM.install.iso
    outputImageName: elemental-image.iso
operatingSystem:
  users:
    - username: root
      encryptedPassword: \$6\$jHugJNNd3HElGsUZ\$eodjVe4te5ps44SVcWshdfWizrP.xAyd71CVEXazBJ/.v799/WRCBXxfYmunlBO2yp1hm/zb4r8EmnrrNCF.P/
EOF</pre></div><div id="id-1.3.4.6.7.8" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The unencoded password is <code class="literal">eib</code>.</p></li><li class="listitem"><p>The <code class="literal">cat</code> command escapes each <code class="literal">$</code> with a backslash (<code class="literal">\</code>) so that Bash does not template them. Remove the backslashes if copying manually.</p></li></ul></div></div><div class="verbatim-wrap highlight bash"><pre class="screen">podman run --privileged --rm -it -v $ELEM/eib_quickstart/:/eib \
 registry.suse.com/edge/edge-image-builder:1.0.2 \
 build --definition-file eib-config.yaml</pre></div><p>If you are booting a physical device, we need to burn the image to a USB flash drive. This can be done with:</p><div class="verbatim-wrap highlight bash"><pre class="screen">sudo dd if=/eib_quickstart/elemental-image.iso of=/dev/&lt;PATH_TO_DISK_DEVICE&gt; status=progress</pre></div></section><section class="sect2" id="boot-downstream-nodes" data-id-title="Boot the downstream nodes"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.5 </span><span class="title-name">Boot the downstream nodes</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#boot-downstream-nodes">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Now that we have created the installation media, we can boot our downstream nodes with it.</p><p>For each of the systems that you want to control with Elemental, add the installation media and boot the device. After installation, it will reboot and register itself.</p><p>If you are using the UI extension, you should see your node appear in the "Inventory of Machines."</p><div id="id-1.3.4.6.8.5" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.svg"/><div class="admon-title">Note</div><p>Do not remove the installation medium until you’ve seen the login prompt; during first-boot files are still accessed on the USB stick.</p></div></section><section class="sect2" id="create-downstream-clusters" data-id-title="Create downstream clusters"><div class="titlepage"><div><div><div class="title-container"><h3 class="title"><span class="title-number-name"><span class="title-number">2.3.6 </span><span class="title-name">Create downstream clusters</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#create-downstream-clusters">#</a></h3><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>There are two objects we need to create when provisioning a new cluster using Elemental.</p><div class="variablelist"><dl class="variablelist tabs"><dt id="id-1.3.4.6.9.3.1"><span class="term">Linux</span></dt><dd><p>The first is the <code class="literal">MachineInventorySelectorTemplate</code>. This object allows us to specify a mapping between clusters and the machines in the inventory.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Create a selector which will match any machine in the inventory with a label:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">cat &lt;&lt; EOF &gt; $ELEM/selector.yaml
apiVersion: elemental.cattle.io/v1beta1
kind: MachineInventorySelectorTemplate
metadata:
  name: location-123-selector
  namespace: fleet-default
spec:
  template:
    spec:
      selector:
        matchLabels:
          locationID: '123'
EOF</pre></div></li><li class="listitem"><p>Apply the resource to the cluster:</p><div class="verbatim-wrap highlight bash"><pre class="screen">kubectl apply -f $ELEM/selector.yaml</pre></div></li><li class="listitem"><p>Obtain the name of the machine and add the matching label:</p><div class="verbatim-wrap highlight bash"><pre class="screen">MACHINENAME=$(kubectl get MachineInventory -n fleet-default | awk 'NR&gt;1 {print $1}')

kubectl label MachineInventory -n fleet-default \
 $MACHINENAME locationID=123</pre></div></li><li class="listitem"><p>Create a simple single-node K3s cluster resource and apply it to the cluster:</p><div class="verbatim-wrap highlight bash"><pre class="screen">cat &lt;&lt; EOF &gt; $ELEM/cluster.yaml
apiVersion: provisioning.cattle.io/v1
kind: Cluster
metadata:
  name: location-123
  namespace: fleet-default
spec:
  kubernetesVersion: v1.28.9+k3s1
  rkeConfig:
    machinePools:
      - name: pool1
        quantity: 1
        etcdRole: true
        controlPlaneRole: true
        workerRole: true
        machineConfigRef:
          kind: MachineInventorySelectorTemplate
          name: location-123-selector
          apiVersion: elemental.cattle.io/v1beta1
EOF

kubectl apply -f $ELEM/cluster.yaml</pre></div></li></ol></div></dd><dt id="id-1.3.4.6.9.3.2"><span class="term">UI Extension</span></dt><dd><p>The UI extension allows for a few shortcuts to be taken. Note that managing multiple locations may involve too much manual work.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>As before, open the left three-dot menu and select "OS Management." This brings you back to the main screen for managing your Elemental systems.</p></li><li class="listitem"><p>On the left sidebar, click "Inventory of Machines." This opens the inventory of machines that have registered.</p></li><li class="listitem"><p>To create a cluster from these machines, select the systems you want, click the "Actions" drop-down list, then "Create Elemental Cluster." This opens the Cluster Creation dialog while also creating a MachineSelectorTemplate to use in the background.</p></li><li class="listitem"><p>On this screen, configure the cluster you want to be built. For this quick start, K3s v1.28.9+k3s1 is selected and the rest of the options are left as is.</p><div id="id-1.3.4.6.9.3.2.2.2.4.2" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>You may need to scroll down to see more options.</p></div></li></ol></div></dd></dl></div><p>After creating these objects, you should see a new Kubernetes cluster spin up using the new node you just installed with.</p><div id="id-1.3.4.6.9.5" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.svg"/><div class="admon-title">Tip</div><p>To allow for easier grouping of systems, you could add a startup script that finds something in the environment that is known to be unique to that location.</p><p>For example, if you know that each location will have a unique subnet, you can write a script that finds the network prefix and adds a label to the corresponding MachineInventory.</p><p>This would typically be custom to your system’s design but could look like:</p><div class="verbatim-wrap highlight bash"><pre class="screen">INET=`ip addr show dev eth0 | grep "inet\ "`
elemental-register --label "network=$INET" \
 --label "network=$INET" /oem/registration</pre></div></div></section></section><section class="sect1" id="id-node-reset" data-id-title="Node Reset"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.4 </span><span class="title-name">Node Reset</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-node-reset">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>SUSE Rancher Elemental supports the ability to perform a "node reset" which can optionally trigger when either a whole cluster is deleted from Rancher, a single node is deleted from a cluster, or a node is manually deleted from the machine inventory. This is useful when you want to reset and clean-up any orphaned resources and want to automatically bring the cleaned node back into the machine inventory so it can be reused. This is not enabled by default, and thus any system that is removed, will not be cleaned up (i.e. data will not be removed, and any Kubernetes cluster resources will continue to operate on the downstream clusters) and it will require manual intervention to wipe data and re-register the machine to Rancher via Elemental.</p><p>If you wish for this functionality to be enabled by default, you need to make sure that your <code class="literal">MachineRegistration</code> explicitly enables this by adding <code class="literal">config.elemental.reset.enabled: true</code>, for example:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">config:
  elemental:
    registration:
      auth: tpm
    reset:
      enabled: true</pre></div><p>Then, all systems registered with this <code class="literal">MachineRegistration</code> will automatically receive the <code class="literal">elemental.cattle.io/resettable: 'true'</code> annotation in their configuration. If you wish to do this manually on individual nodes, e.g. because you’ve got an existing <code class="literal">MachineInventory</code> that doesn’t have this annotation, or you have already deployed nodes, you can modify the <code class="literal">MachineInventory</code> and add the <code class="literal">resettable</code> configuration, for example:</p><div class="verbatim-wrap highlight yaml"><pre class="screen">apiVersion: elemental.cattle.io/v1beta1
kind: MachineInventory
metadata:
  annotations:
    elemental.cattle.io/os.unmanaged: 'true'
    elemental.cattle.io/resettable: 'true'</pre></div><p>In SUSE Edge 3.0, the Elemental Operator puts down a marker on the operating system that will trigger the cleanup process automatically; it will stop all Kubernetes services, remove all persistent data, uninstall all Kubernetes services, cleanup any remaining Kubernetes/Rancher directories, and force a re-registration to Rancher via the original Elemental <code class="literal">MachineRegistration</code> configuration. This happens automaticaly, there is no need for any manual intervention. The script that gets called can be found in <code class="literal">/opt/edge/elemental_node_cleanup.sh</code> and is triggered via <code class="literal">systemd.path</code> upon the placement of the marker, so its execution is immediate.</p><div id="id-1.3.4.7.8" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.svg"/><div class="admon-title">Warning</div><p>Using the <code class="literal">resettable</code> functionality assumes that the desired behavior when removing a node/cluster from Rancher is to wipe data and force a re-registration. Data loss is guaranteed in this situation, so only use this if you’re sure that you want automatic reset to be performed.</p></div></section><section class="sect1" id="id-next-steps" data-id-title="Next steps"><div class="titlepage"><div><div><div class="title-container"><h2 class="title"><span class="title-number-name"><span class="title-number">2.5 </span><span class="title-name">Next steps</span></span> <a title="Permalink" class="permalink" href="quickstart-elemental.html#id-next-steps">#</a></h2><div class="icons"><a target="_blank" class="icon-reportbug" title="Report an issue"> </a></div></div></div></div></div><p>Here are some recommended resources to research after using this guide:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>End-to-end automation in <a class="xref" href="components-fleet.html" title="Chapter 6. Fleet">Chapter 6, <em>Fleet</em></a></p></li><li class="listitem"><p>Additional network configuration options in <a class="xref" href="components-nmc.html" title="Chapter 10. Edge Networking">Chapter 10, <em>Edge Networking</em></a></p></li></ul></div></section></section><nav class="bottom-pagination"><div><a class="pagination-link prev" href="quickstart-metal3.html"><span class="pagination-relation">Previous</span><span class="pagination-label"><span class="title-number">Chapter 1 </span>BMC automated deployments with Metal<sup>3</sup></span></a> </div><div><a class="pagination-link next" href="quickstart-eib.html"><span class="pagination-relation">Next</span><span class="pagination-label"><span class="title-number">Chapter 3 </span>Standalone clusters with Edge Image Builder</span></a> </div></nav></article><aside id="_side-toc-page" class="side-toc"><div class="side-title">On this page</div><div class="toc"><ul><li><span class="section"><a href="quickstart-elemental.html#id-high-level-architecture-2"><span class="title-number">2.1 </span><span class="title-name">High-level architecture</span></a></span></li><li><span class="section"><a href="quickstart-elemental.html#id-resources-needed"><span class="title-number">2.2 </span><span class="title-name">Resources needed</span></a></span></li><li><span class="section"><a href="quickstart-elemental.html#id-how-to-use-elemental"><span class="title-number">2.3 </span><span class="title-name">How to use Elemental</span></a></span></li><li><span class="section"><a href="quickstart-elemental.html#id-node-reset"><span class="title-number">2.4 </span><span class="title-name">Node Reset</span></a></span></li><li><span class="section"><a href="quickstart-elemental.html#id-next-steps"><span class="title-number">2.5 </span><span class="title-name">Next steps</span></a></span></li></ul></div><div class="side-title">Share this page</div><ul class="share"><li><a id="_share-fb" href="#" title="Facebook"> </a></li><li><a id="_share-in" href="#" title="LinkedIn"> </a></li><li><a id="_share-tw" href="#" title="Twitter/X"> </a></li><li><a id="_share-mail" href="#" title="E-Mail"> </a></li><li><a id="_print-button" href="#" title="Print this page"> </a></li></ul> </aside></main><footer id="_footer"><div class="growth-inhibitor"><div class="copy"><span class="copy__rights">© SUSE
                 2024</span></div></div></footer></body></html>